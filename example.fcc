variant: fcos
version: 1.1.0

passwd:
  users:
  - name: core
    password_hash: "$1$0Jv3aq2a$BJtVPlmsfJml1riK.JDNk0"
    # ssh_authorized_keys:
    # - ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQCsKfncWkb7cU2AEhZHOkzj5sqy6JxBKL9G2YvwqMqY1o625BBMJZ+ICK3YI05tUVjYxb82trHPR8aGjsXTfiRxcZPXzPmsWGjOZDicJTd4YVoycPEPzCXBrZzwzCqT2QlhtzPyrMruJF/gVVenZseGBD0hdcojO9BrjwXhSBfSEfw7Og9B+p1Jszo0Ie1a93go10bBatsXcajEQP9bxRzd6f16zO8eTIMKdlmb90otOWX5Iom4RBY1XzKzAxZd3xgMyhIkdpq+wWauBVhQHhuTyGyy2UOBwF7ldmk5VqxIbxVtaIcpSN8jGAb8eUvSzkuEH1wVlYVpiRExlmmkqSftaWn1GbdoFB2/XHvlhZ6C8bWCGybDSoyugDIQ894pwJWNct2Uw+Y4rT26Ztz4PrDszKPcaP1z+xmWVAz00FjpD6BMZRcfV3UlKvknZnodPXNHr+Q3k1CsovLBrpvgJLi0JQJlu7jqpe2rwzSOc2q+bX/hC7dUzoyDQtLxr/piy1qqDC1xjjwNfgtwVKj0r0qht6NsIOoXSktEIy648AGUlmpV71wqaemXUk4I7+csIlpkDfP8EAPXhADfvfpDx1OwKCm4J+AZfaLYzFBEXuhj2V+8f/4YlSRSGCQH+O3mfF9sSx2DW8Oplb7n4L7G3vbYNobrE8zhjoQ7T2/eprcQgw==

systemd:
  units:
    - name: serial-getty@ttyS0.service
      dropins:
      - name: autologin-core.conf
        contents: |
          [Service]
          # Override Execstart in main unit
          ExecStart=
          # Add new Execstart with `-` prefix to ignore failure`
          ExecStart=-/usr/sbin/agetty --autologin core --noclear %I $TERM
    - name: install-packages.service
      enabled: true
      contents: |
        [Unit]
        Description=Install required OS packages
        After=network-online.target
        Wants=network-online.target
        [Service]
        Type=oneshot
        # Install required packages
        # ExecStart=/usr/bin/rpm-ostree install git
        # ExecStart=/usr/bin/rpm-ostree install ansible
        # ExecStart=/usr/bin/rpm-ostree install fail2ban
        # ExecStart=/usr/bin/rpm-ostree install google-authenticator
        # ExecStart=/usr/bin/systemctl reboot
        ExecStart=/test.sh
        [Install]
        WantedBy=multi-user.target
storage:
  files:
    - path: /test.sh
      mode: 0755
      contents:
        inline: |
          #!/usr/bin/bash
          /usr/bin/rpm-ostree install git
          /usr/bin/rpm-ostree install ansible
          /usr/bin/rpm-ostree install fail2ban
          /usr/bin/rpm-ostree install google-authenticator
          #/usr/bin/systemctl reboot
    - path: /etc/hostname
      mode: 0644
      contents:
        inline: |
          tutorial
    - path: /etc/profile.d/systemd-pager.sh
      mode: 0644
      contents:
        inline: |
          # Tell systemd to not use a pager when printing information
          export SYSTEMD_PAGER=cat
    - path: /etc/sysctl.d/20-silence-audit.conf
      mode: 0644
      contents:
        inline: |
          # Raise console message logging level from DEBUG (7) to WARNING (4)
          # to hide audit messages from the interactive console
          kernel.printk=4